<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8" />
        <title>validator.js演示</title>
        <link rel="stylesheet" href="bootstrap.css" />
        <script src="validator.min.js"></script>
    </head>
    <style>
        .valid-error {
            display: block;
            margin: 5px 0;
            font-style: normal;
            color: orangered;
        }
    </style>

    <body>
        <div class="container">

            <h2>表单验证</h2>
            <form id="validate_form" novalidate="">

                <div class="form-group">
                    <label for="email">邮箱：</label>
                    <input class="form-control" id="email" name="email" type="email" placeholder="请输入邮箱" />
                </div>

                <div class="form-group">
                    <button class="btn btn-default" id="setErrorEmail" type="button">设置错误邮箱</button> 
                    <button class="btn btn-default" id="setRightEmail" type="button">设置正确邮箱</button> 
                    <button class="btn btn-info" id="validEmail" type="button">验证邮箱</button>
                </div>

                <div class="form-group">
                    <label for="phone">手机：</label>
                    <input class="form-control" id="phone" name="phone" type="text" placeholder="请输入手机号" />
                </div>

                <div class="form-group">
                    <label for="birthday">生日：</label>
                    <input class="form-control" id="birthday" name="birthday" type="text" placeholder="请填写生日">
                </div>

                <div class="form-group">
                    <label>性别：</label>
                    <div class="radio">
                        <label>
                            <input id="male" type="radio" name="sex" value="0" /> 男
                        </label>
                        <label>
                            <input id="female" type="radio" name="sex" value="1" /> 女
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="city">城市：</label>
                    <select class="form-control" id="city" name="city">
                        <option value="">请选择</option>
                        <option value="0">北京</option>
                        <option value="1">上海</option>
                        <option value="2">重庆</option>
                        <option value="3">成都</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>爱好：</label>
                    <div class="checkbox">
                        <label>
                            <input id="badminton" name="hobby" type="checkbox" value="1" /> 羽毛球
                        </label>
                        <label>
                            <input id="swim" name="hobby" type="checkbox" value="2" /> 游泳
                        </label>
                        <label>
                            <input id="run" name="hobby" type="checkbox" value="3" /> 跑步
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="remarks">简介：</label>
                    <textarea class="form-control" id="remarks" name="remarks" rows="3" placeholder="一句话描述自己"></textarea>
                </div>

                <input class="btn btn-primary" id="submit" type="submit" value="提交" />

            </form>
        </div>

        <script>
            var validator = new Validator('validate_form', {
                fields: {
                    email: {
                        rules: 'required | is_email | max_length(32)',
                        messages: "不能为空 | 请输入合法邮箱 | 输入的文字太长"
                    },
                    phone: {
                        rules: 'is_phone',
                        messages: "手机号： {{phone}} 不合法"
                    },
                    birthday: {
                        rules: 'required | is_date',
                        messages: "不能为空 | 请输入合法日期"
                    },
                    sex: {
                        rules: 'required',
                        messages: "不能为空"
                    },
                    city: {
                        rules: 'required',
                        messages: "不能为空"
                    },
                    hobby: {
                        rules: 'required | select_limit(2)',
                        messages: "不能为空 | 至少选择两项"
                    },
                    remarks: {
                        rules: 'max_length(48)',
                        messages: "输入的文字太长"
                    }
                },
                // 参数：errorEl 错误信息节点，fieldEl 出现错误的表单节点
                errorPlacement: function(errorEl, fieldEl) {
                    // 非 label 、radio 元素
                    if (fieldEl.parentNode !== undefined) {
                        fieldEl.parentNode.appendChild(errorEl);
                    } else {
                        fieldEl[0].parentNode.parentNode.parentNode.appendChild(errorEl);
                    }
                },
                callback: function(event) {
                    // 阻止提交
                    event.preventDefault();
                    // 设置按钮样式
                    var submitButton = event.target['submit'];
                    submitButton.classList.remove('btn-primary');
                    submitButton.classList.add('btn-success');
                    submitButton.value = '已验证成功';
                }
            });

            // 至少选择两项
            // 扩展内部验证方法 field: 验证域， param: 参数 如 select_limit(2)
            validator.addMethod('select_limit', function(field, param) {
                // 选择的条目数
                var checkedNum = 0;
                for (var i = 0, elLength = field.el.length; i < elLength; i++) {
                    if (field.el[i].checked) {
                        checkedNum += 1;
                    }
                }
                return checkedNum >= param;
            });

            // 设置邮箱值
            var emailEL = document.getElementById('email');

            document.getElementById('setErrorEmail').addEventListener('click', function(e) {
                emailEL.value = 'anonymous#qq.com';
            });

            document.getElementById('setRightEmail').addEventListener('click', function(e) {
                emailEL.value = 'anonymous@qq.com';
            });

            // 验证邮箱值
            var validEmailButton = document.getElementById('validEmail');
            validEmailButton.addEventListener('click', function(e) {
                // 通过 name 验证单个表单域
                validator.validateByName('email');
            });

        </script>
    </body>

</html>